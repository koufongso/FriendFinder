<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <!--boostrap-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>

    <title>Survey</title>
</head>

<body>

    <!-- Button trigger modal -->
    <button id="btn-modal" type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal"
        style="display: none;"></button>

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Your Best Match</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <!--survey-->
    <div class="container">
        <form method="POST">
            <div class="form-body">
                <div class="form-group">
                    <label for="name">Name</label>
                    <input class="form-control" type="text" id="name" name="name"
                        placeholder="Please enter your name ..." />
                </div>
                <div class="form-group">
                    <label for="picture_url">Profile URL</label>
                    <input class="form-control" type="url" id="picture_url" name="picture_url" pattern="https://.*"
                        placeholder="Please enter your picture url ..." />
                </div>

                <br>
                <h3>Please answer the following questions on the scale of 1 - 5 (1 is lowest, 5 is highest)</h3>
                <br>
            </div>

            <button class="btn btn-primary" type="submit" id="form-submit">Submit & Match</button>
        </form>
    </div>


    <script>
        // design the questions here
        var questionList = ["How much do you enjoy playing sport?",
            "How much do you enjoy hiking?",
            "How much do you enjoy coking?",
            "How much do you enjoy watching movies?",
            "How much do you enjoy listening music?",
            "How much do you enjoy reading?",
            "How much do you enjoy playing video games?",
            "How much do you like pets?",
            "Are you an outgoing person?",
            "Do you like social media?"];

        for (var i = 0; i < questionList.length; i++) {
            var template = `<div class="form-group question">
                <label>${i + 1}.${questionList[i]}</label>
                <div class="form-control" style="border:none">
                    <div class="form-check form-check-inline col-1">
                        <input class="form-check-input" type="radio" name="inlineRadioOptions${i + 1}" id="inlineRadio1"
                            value="1">
                        <label class="form-check-label" for="inlineRadio1">1</label>
                    </div>
                    <div class="form-check form-check-inline col-1">
                        <input class="form-check-input" type="radio" name="inlineRadioOptions${i + 1}" id="inlineRadio2"
                            value="2">
                        <label class="form-check-label" for="inlineRadio2">2</label>
                    </div>
                    <div class="form-check form-check-inline col-1">
                        <input class="form-check-input" type="radio" name="inlineRadioOptions${i + 1}" id="inlineRadio3"
                            value="3">
                        <label class="form-check-label" for="inlineRadio3">3</label>
                    </div>
                    <div class="form-check form-check-inline col-1">
                        <input class="form-check-input" type="radio" name="inlineRadioOptions${i + 1}" id="inlineRadio4"
                            value="4">
                        <label class="form-check-label" for="inlineRadio3">4</label>
                    </div>
                    <div class="form-check form-check-inline col-1">
                        <input class="form-check-input" type="radio" name="inlineRadioOptions${i + 1}" id="inlineRadio5"
                            value="5">
                        <label class="form-check-label" for="inlineRadio5">5</label>
                    </div>
                </div>
            </div>`
            $(".form-body").append(template);
        }

        // submit 
        $("#form-submit").on("click", function (event) {
            event.preventDefault();
            var name = $("#name").val().trim();
            var url = $("#picture_url").val().trim();
            var inputs = $("form .question .form-control input:checked");

            if (name === "") {
                alert("Please enter your name.");
            } else if(url===""){
                alert("Please enter your profile picture url.");
            }
            else if (inputs.length != questionList.length) {
                alert("Please answer all the questions before submission.");
            } else {
                var scores = [];
                for (var i = 0; i < inputs.length; i++) {
                    scores.push(parseInt(inputs[i].value));
                }
                var newData = {
                    "name": name,
                    "photo":url,
                    "scores": scores
                }

                // console.log(JSON.stringify(data));
                $.post("/api/friends", newData, function (data, status) {
                    console.log(status);
                    if (status == "success") {
                        console.log(data);
                        alert("Success! Your information is in the database now.");
                        render(this, data);
                        // clear
                        $("#name").val("");
                        $(".form-check-input").prop("checked", false);
                    }
                }).fail(function () {
                    alert("Opps, it seems something is wrong. Please try again.");
                });
            }
        });

        function render(button, data) {
            $(".modal-body").empty();
            $(".modal-body").append(`<h1>${data.name}</h1>`);
            $(".modal-body").append(`<img src=${data.photo} alt="profile picture"></img>`);
            $("#btn-modal").click();
        }

    </script>

</html>